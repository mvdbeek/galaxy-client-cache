name: Build client
on: [push]
jobs:
  build:
    name: Build client
    runs-on: ubuntu-18.04
    strategy:
      matrix:
        branch: ['master', 'dev', 'release_19.09', 'release_20.01']
    steps:
      - name: Clone Galaxy
        run: git clone --depth=1 -b ${{ matrix.branch }}  https://github.com/galaxyproject/galaxy
      - name: Build client
        run: cd galaxy/client && yarn install --network-timeout 300000 --check-files && yarn run build && cd ../
      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v1
      - name: Archive client
        run: tar -czf ../${{ matrix.branch }}-$(cat static/client_build_hash.txt)-client.tar.gz static/
